<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Admin | Certificate Automation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/styles.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>    
    </head>
    <body style="background-color: #F7FAFF;">
        <div class="container" style="display: flex; flex-direction:column; justify-content: start; " >
            <header>
                <img src="/logo.png" width="100"/>
                <div class="header__list">
                    <div class="header__list__item"><a href="/admin"><i class="fa-solid fa-certificate"></i> &nbsp; Certificates</a></div>
                    <div class="header__list__item active"><a href="/admin/users"><i class="fa-solid fa-user"></i> &nbsp; Users</a></div>
                    <div class="header__list__item" onclick="logout()"><i class="fa-solid fa-arrow-right-from-bracket"></i> &nbsp; Logout</div>

                </div>
            </header>
            <table>
                <thead>
                <tr class="table100-head">
                <th class="column1">#</th>
                <th class="column2">User</th>
                <th class="column3">Events Created</th>
                <th class="column4">User Created At</th>
                <th class="column6">Role</th>
                </tr>
                </thead>
                <tbody>
                    <% for (i =0; i<users.length; i++){%>
                        <tr>
                            <td><%=(i+1)%></td>
                            <td><%= users[i].email%></td>
                            <td><%= users[i].eventName.length%></td>
                            <td><%= users[i].createdAt%></td>
                            <td class="column6">
                                <%if(users[i].role==="innovator"){%>
                                    <% if(users[i].requestAccess === false){%>
                                    <button class="users__button__promote" onclick="changeRole(`<%= users[i].email%>`,`admin`)">Promote</button>
                                    <%}else{%>
                                        <button class="users__button__promote" onclick="changeRole(`<%= users[i].email%>`,`admin`)">Grant Access</button>
                                    <%}%>

                                <%} else{%>
                                <button class="users__button__demote" onclick="changeRole(`<%= users[i].email%>`,`innovator`)">Demote</button>
                                <%}%>
                            </td>
                        </tr>
                    <%}%>
                </tbody>
                </table>
        </div>
        <script>
            const changeRole = (email, role) => {
                $.post("/api/change-role", {
                    "email": email,
                    "role": role
                }).then((res) => {
                    if(res==="done") location.reload();
                })
            }
            const logout = () => {
                $.get('/auth/logout').then((res) => {
                    if(res== 'done'){
                        location.reload();
                    }
                })
            }
        </script>
    </body>
</html>